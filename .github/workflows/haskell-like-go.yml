name: "ğŸ¹ Haskell-like-Go â€” Functional Fusion (v3OS Full Release v1.0)"

on:
  push:
    branches: [ main ]
  pull_request:
    types: [ closed ]
  schedule:
    - cron: "0 0 * * *"
  workflow_dispatch:

permissions:
  contents: write

concurrency:
  group: haskell-like-go-${{ github.ref }}
  cancel-in-progress: true

jobs:
  build-3os:
    name: "Build & Release (${{ matrix.os }})"
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [ubuntu-latest, macos-latest, windows-latest]

    steps:
      - name: "ğŸ§­ Checkout Repository"
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: "ğŸ”§ Setup Go Environment"
        uses: actions/setup-go@v5
        with:
          go-version: "1.23"

      - name: "ğŸ› ï¸ Build Executable"
        run: |
          mkdir -p dist
          go build -o dist/haskell_like_go main.go

      - name: "ğŸ§¾ Generate ProofLedger"
        shell: bash
        run: |
          echo "ğŸ§¾ Generating ProofLedger..."
          cd dist
          sha256sum haskell_like_go* > PROOF_LEDGER.txt 2>/dev/null || shasum -a 256 haskell_like_go* > PROOF_LEDGER.txt
          echo "âœ… ProofLedger generated:"
          cat PROOF_LEDGER.txt

      - name: "ğŸ—œï¸ Normalize Executable Name"
        shell: bash
        run: |
          cd dist
          if [ "$RUNNER_OS" = "Windows" ]; then
            mv haskell_like_go haskell_like_go.exe 2>/dev/null || true
          fi
          ls -al

      - name: "ğŸš€ Publish Multi-OS Release"
        uses: softprops/action-gh-release@v1
        if: github.ref == 'refs/heads/main'
        with:
          tag_name: v1.0.${{ github.run_number }}
          name: "Haskell-like-Go â€” Full 3OS Build #${{ github.run_number }}"
          body: |
            ğŸ¹ **Haskell-like-Go (Full Multi-OS Edition)**  
            Functional Fusion Compiler Prototype  
            - âœ… Linux / macOS / Windows ì™„ì „ì§€ì›  
            - ğŸ”’ ProofLedger ìë™ ìƒì„±  
            - ğŸ§© Auto-build + Auto-release pipeline  
          files: |
            dist/**
